<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>åœ¨çº¿åˆ·é¢˜å·¥å…·</title>
<style>
body { font-family: "Microsoft YaHei", sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background: #f4f6f9; }
.container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
h2 { text-align: center; color: #2c3e50; }
.progress { margin-bottom: 20px; font-size: 16px; }
.question { margin-bottom: 20px; font-size: 18px; }
.options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
button.option-btn { padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; text-align: left; }
button.option-btn.selected { background: #d0f0d0; }
button.confirm-btn { padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background: #28a745; color: white; cursor: pointer; margin-top: 10px; }
button.confirm-btn:hover { background: #218838; }
#feedback { margin-bottom: 20px; font-weight: bold; }
#start-panel { margin-bottom: 20px; text-align: center; }
#num-select { font-size: 16px; padding: 5px; }
#result-panel { display: none; }
.result-item { margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
.correct { color: green; font-weight: bold; }
.incorrect { color: red; font-weight: bold; }
</style>
</head>
<body>
<div class="container">
    <h2>åœ¨çº¿åˆ·é¢˜å·¥å…·</h2>

    <!-- å¼€å§‹é¢æ¿ -->
    <div id="start-panel">
        <label for="num-select">é€‰æ‹©æ¯æ¬¡æŠ½å–é¢˜ç›®æ•°é‡ï¼š</label>
        <select id="num-select">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="30">30</option>
        </select>
        <button id="start-btn" class="confirm-btn">å¼€å§‹åˆ·é¢˜</button>
    </div>

    <!-- åˆ·é¢˜é¢æ¿ -->
    <div id="quiz-container" style="display:none;">
        <div class="progress" id="progress"></div>
        <div id="question" class="question"></div>
        <div id="options" class="options"></div>
        <button id="submit-btn" class="confirm-btn" style="display:none;">æäº¤ç­”æ¡ˆ</button>
        <div id="feedback"></div>
        <button id="next-btn" class="confirm-btn" style="display:none;">ä¸‹ä¸€é¢˜</button>
    </div>

    <!-- ç»“ç®—é¢æ¿ -->
    <div id="result-panel">
        <h2>ğŸ“Š åˆ·é¢˜ç»“æœ</h2>
        <div id="score"></div>
        <div id="wrong-list"></div>
        <button id="retry-btn" class="confirm-btn">å†æ¥ä¸€ç»„</button>
        <button id="return-btn" class="confirm-btn">è¿”å›ä¸»ç•Œé¢</button>
    </div>
</div>

<script>
let questionBank = [];
let quizQuestions = [];
let currentIndex = 0;
let selectedAnswers = [];
let numQuestions = 5;
let results = [];

const progressEl = document.getElementById("progress");
const questionEl = document.getElementById("question");
const optionsEl = document.getElementById("options");
const feedbackEl = document.getElementById("feedback");
const submitBtn = document.getElementById("submit-btn");
const nextBtn = document.getElementById("next-btn");
const startPanel = document.getElementById("start-panel");
const quizContainer = document.getElementById("quiz-container");
const resultPanel = document.getElementById("result-panel");
const scoreEl = document.getElementById("score");
const wrongListEl = document.getElementById("wrong-list");
const numSelect = document.getElementById("num-select");
const startBtn = document.getElementById("start-btn");
const retryBtn = document.getElementById("retry-btn");
const returnBtn = document.getElementById("return-btn");

// ================== åŠ è½½é¢˜åº“ ==================
fetch("tiku.json")
    .then(res => res.json())
    .then(data => { questionBank = data; })
    .catch(err => alert("åŠ è½½é¢˜åº“å¤±è´¥ï¼Œè¯·æ£€æŸ¥ json æ–‡ä»¶"));

// ================== éšæœºæŠ½é¢˜ ==================
function getRandomQuestions(arr, n) {
    const shuffled = [...arr].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, n);
}

// ================== å¼€å§‹åˆ·é¢˜ ==================
startBtn.onclick = () => startQuiz();
retryBtn.onclick = () => startQuiz(numQuestions);
returnBtn.onclick = () => {
    resultPanel.style.display = "none";
    startPanel.style.display = "block";
};

function startQuiz(customNum) {
    if (customNum) numQuestions = customNum;
    quizQuestions = getRandomQuestions(questionBank, Math.min(numQuestions, questionBank.length));
    currentIndex = 0;
    results = [];
    startPanel.style.display = "none";
    resultPanel.style.display = "none";
    quizContainer.style.display = "block";
    showQuestion();
}

function showQuestion() {
    feedbackEl.innerText = "";
    nextBtn.style.display = "none";
    submitBtn.style.display = "inline-block";
    selectedAnswers = [];

    const q = quizQuestions[currentIndex];
    const isMultiple = q.answer.length > 1;

    progressEl.innerText = `é¢˜ç›® ${currentIndex + 1} / ${quizQuestions.length} ï¼ˆID: ${q.id}ï¼‰`;
    questionEl.innerText = `${q.question}`;
    optionsEl.innerHTML = "";

    for (const key in q.options) {
        const btn = document.createElement("button");
        btn.innerText = `${key}. ${q.options[key]}`;
        btn.className = "option-btn";
        btn.onclick = () => selectOption(btn, key, isMultiple);
        optionsEl.appendChild(btn);
    }
}

function selectOption(btn, key, isMultiple) {
    if (isMultiple) {
        if (selectedAnswers.includes(key)) {
            selectedAnswers = selectedAnswers.filter(k => k !== key);
            btn.classList.remove("selected");
        } else {
            selectedAnswers.push(key);
            btn.classList.add("selected");
        }
    } else {
        selectedAnswers = [key];
        optionsEl.querySelectorAll("button").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
    }
}

submitBtn.onclick = () => {
    const q = quizQuestions[currentIndex];
    if (selectedAnswers.length === 0) {
        alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼");
        return;
    }
    optionsEl.querySelectorAll("button").forEach(btn => btn.disabled = true);
    submitBtn.style.display = "none";

    const correct = arraysEqual(selectedAnswers, q.answer);
    results.push({ q, selected: [...selectedAnswers], correct });

    if (correct) {
        feedbackEl.style.color = "green";
        feedbackEl.innerText = "âœ… æ­£ç¡®ï¼";
    } else {
        feedbackEl.style.color = "red";
        const ansText = q.answer.map(a => `${a}. ${q.options[a]}`).join("  ");
        feedbackEl.innerText = `âŒ é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆï¼š${ansText}`;
    }
    nextBtn.style.display = "inline-block";
}

nextBtn.onclick = () => {
    currentIndex++;
    if (currentIndex < quizQuestions.length) {
        showQuestion();
    } else {
        showResult();
    }
}

function arraysEqual(a, b) {
    if (!a || !b) return false;
    if (a.length !== b.length) return false;
    const sortedA = [...a].sort();
    const sortedB = [...b].sort();
    return sortedA.every((val, idx) => val === sortedB[idx]);
}

function showResult() {
    quizContainer.style.display = "none";
    resultPanel.style.display = "block";

    const correctCount = results.filter(r => r.correct).length;
    const total = results.length;
    const rate = ((correctCount / total) * 100).toFixed(1);
    scoreEl.innerHTML = `<p>æ­£ç¡®é¢˜æ•°ï¼š${correctCount} / ${total} &nbsp;&nbsp; æ­£ç¡®ç‡ï¼š${rate}%</p>`;

    const wrongs = results.filter(r => !r.correct);
    wrongListEl.innerHTML = "";
    if (wrongs.length > 0) {
        wrongListEl.innerHTML = "<h3>âŒ é”™é¢˜å›é¡¾ï¼š</h3>";
        wrongs.forEach(r => {
            const div = document.createElement("div");
            div.className = "result-item";
            const ansText = r.q.answer.map(a => `${a}. ${r.q.options[a]}`).join("  ");
            div.innerHTML = `<p><b>ID: ${r.q.id}</b> - ${r.q.question}</p><p>æ­£ç¡®ç­”æ¡ˆï¼š${ansText}</p>`;
            wrongListEl.appendChild(div);
        });
    } else {
        wrongListEl.innerHTML = "<p>ğŸ‰ å…¨éƒ¨ç­”å¯¹ï¼</p>";
    }
}
</script>
</body>
</html>
